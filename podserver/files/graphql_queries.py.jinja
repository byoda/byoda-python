'''
Automatically generated code for GraphQL support for a Byoda service.
The code was generated by the 'generate_graphql_queries script'
using the 'podserver/files/grahphql_schema.jinja' template

:maintainer : Steven Hessing <steven@byoda.org>
:copyright  : Copyright 2021, 2022
:license    : GPLv3
'''

GRAPHQL_STATEMENTS = {}

{% set ns = namespace(classes_seen='') %}
{% for root_class in classes.values() %}
{%   if root_class.type != DataType.ARRAY  %}

QUERY_{{ root_class.name|upper }} = '''
query ($filters: {{ root_class.name|to_lower_camel }}InputFilter, $first: Int, $after: String,
        $depth: Int, $relations: [String!]) {
    {{ root_class.name }}_connection(
            filters: $filters, first: $first, after: $after, depth: $depth,
            relations: $relations) {
        total_count
        edges {
            cursor
            origin
            {{ root_class.name }} {
{%     for field in root_class.fields.values() %}
                {{ field.name }}
{%     endfor %}
            }
        }
        page_info {
            end_cursor
            has_next_page
        }
    }
}
'''

GRAPHQL_STATEMENTS['{{ root_class.name }}'] = {'query': QUERY_{{ root_class.name|upper }}}

MUTATE_{{ root_class.name|upper }} = '''
mutation(
{%     for field in root_class.fields.values() %}
                    ${{ field.name }}: {{ field.graphql_type }},
{%     endfor %}
) {
    mutate_{{ root_class.name }}(
{%     for field in root_class.fields.values() %}
                    {{ field.name }}: ${{ field.name }},
{%     endfor %}
    ) {
{%     for field in root_class.fields.values() %}
                    {{ field.name }}
{%     endfor %}
    }
}
'''

GRAPHQL_STATEMENTS['{{ root_class.name }}']['mutate'] = MUTATE_{{ root_class.name|upper }}

{%   else %}{# if root_class.type != DataType.ARRAY #}

QUERY_{{ root_class.name|upper }} = '''
query ($filters: {{ root_class.referenced_class.name|to_lower_camel }}InputFilter,
        $first: Int, $after: String, $depth: Int, $relations: [String!]) {
    {{ root_class.name }}_connection(filters: $filters, first: $first, after: $after,
    depth: $depth, relations: $relations) {
        total_count
        edges {
            cursor
            origin
            {{ root_class.referenced_class.name }} {
{%     for field in root_class.referenced_class.fields.values() %}
                {{ field.name }}
{%     endfor %}
            }
        }
        page_info {
            end_cursor
            has_next_page
        }
    }
}
'''

GRAPHQL_STATEMENTS['{{ root_class.name }}'] = {'query': QUERY_{{ root_class.name|upper }}}

APPEND_{{ root_class.name|upper }} = '''
mutation (
{%     for field in root_class.referenced_class.fields.values() %}
                    ${{ field.name }}: {{ field.graphql_type }}{% if field.name in root_class.referenced_class.required_fields %}!{% endif %},
{%     endfor %}
) {
    append_{{ root_class.name }} (
{%     for field in root_class.referenced_class.fields.values() %}
            {{ field.name }}: ${{ field.name }},
{%     endfor %}
    ) {
{%     for field in root_class.referenced_class.fields.values() %}
            {{ field.name }}
{%     endfor %}
    }
}
'''

GRAPHQL_STATEMENTS['{{ root_class.name }}']['append'] = APPEND_{{ root_class.name|upper }}

UPDATE_{{ root_class.name|upper }} = '''
mutation (
    $filters: {{ root_class.referenced_class.name|to_lower_camel }}InputFilter!,
{%     for field in root_class.referenced_class.fields.values() %}
                    ${{ field.name }}: {{ field.graphql_type }},
{%     endfor %}
) {
    update_{{ root_class.name }}(
        filters: $filters,
{%     for field in root_class.referenced_class.fields.values() %}
        {{ field.name }}: ${{ field.name }},
{%     endfor %}
    ) {
{%     for field in root_class.referenced_class.fields.values() %}
        {{ field.name }}
{%     endfor %}
    }
}
'''

GRAPHQL_STATEMENTS['{{ root_class.name }}']['update'] = UPDATE_{{ root_class.name|upper }}

DELETE_FROM_{{ root_class.name|upper }} = '''
mutation ($filters: {{ root_class.referenced_class.name|to_lower_camel }}InputFilter!) {
    delete_from_{{ root_class.name }}(filters: $filters) {
{%     for field in root_class.referenced_class.fields.values() %}
        {{ field.name }}
{%     endfor %}
    }
}
'''

GRAPHQL_STATEMENTS['{{ root_class.name }}']['delete'] = DELETE_FROM_{{ root_class.name|upper }}
{%   endif %}{# if root_class.type != DataType.ARRAY #}
{% endfor %}{# for root_class in classes.values() #}
